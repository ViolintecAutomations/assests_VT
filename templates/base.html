<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> VT Asset Management System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .sidebar {
      min-height: 100vh;
      background: #1c4b79;
      color: #fff;
      padding-top: 2rem;
    }
    .sidebar a {
      color: #fff;
      text-decoration: none;
      display: block;
      padding: 0.75rem 1.5rem;
      border-radius: 0.25rem;
      margin-bottom: 0.5rem;
    }
    .sidebar a.active, .sidebar a:hover {
      background: #0a3d71;
    }
    .sidebar-link {
      transition: transform 0.18s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.18s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
    }
    .sidebar-link:hover {
      transform: scale(1.08);
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      z-index: 2;
      background-color: #0a3d71 !important;
    }
    

  </style>
</head>
<body class="{% if current_user.is_authenticated %}{{ current_user.role }}-user{% endif %}" 
      data-user-role="{% if current_user.is_authenticated %}{{ current_user.role }}{% endif %}" 
      data-user-id="{% if current_user.is_authenticated %}{{ current_user.id }}{% endif %}">
  <div class="container-fluid">
    <div class="row">
      {% if current_user.is_authenticated and current_user.role == 'admin' %}
      <nav class="col-md-2 sidebar">
        <h4 class="text-center mb-4">VT Asset Management System</h4>
        <div id="adminSidebarMenu">
          <!-- Menu items will be loaded dynamically based on permissions -->
        </div>
        <a href="{{ url_for('it.logout') }}" class="sidebar-link"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </nav>
      {% elif current_user.is_authenticated and current_user.role == 'it_team' %}
      <nav class="col-md-2 sidebar">
        <h4 class="text-center mb-4">IT Team Dashboard</h4>
                        <a href="{{ url_for('it.it_dashboard') }}" class="sidebar-link {% if request.path == '/it/it-dashboard' %}active{% endif %}"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
                <a href="{{ url_for('it.assets') }}" class="sidebar-link {% if request.path.startswith('/it/assets') %}active{% endif %}"><i class="bi bi-box-seam me-2"></i>Asset Master</a>
                <a href="{{ url_for('it.assign') }}" class="sidebar-link {% if request.path.startswith('/it/assign') %}active{% endif %}"><i class="bi bi-arrow-left-right me-2"></i>Assign Asset</a>
                <a href="{{ url_for('it.procurement_dashboard') }}" class="sidebar-link {% if request.path.startswith('/it/procurement') %}active{% endif %}"><i class="bi bi-cart-check me-2"></i>Procurement</a>
                <a href="{{ url_for('it.maintenance') }}" class="sidebar-link {% if request.path.startswith('/it/maintenance') %}active{% endif %}"><i class="bi bi-tools me-2"></i>Maintenance</a>
                <a href="{{ url_for('it.requests') }}" class="sidebar-link {% if request.path.startswith('/it/requests') %}active{% endif %}"><i class="bi bi-list-check me-2"></i>Requests</a>
                <a href="{{ url_for('it.reports') }}" class="sidebar-link {% if request.path.startswith('/it/reports') %}active{% endif %}"><i class="bi bi-bar-chart me-2"></i>Reports</a>
        <a href="{{ url_for('it.logout') }}" class="sidebar-link"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </nav>
      {% elif current_user.is_authenticated and current_user.role == 'super_admin' %}
      <nav class="col-md-2 sidebar">
                  <h4 class="text-center mb-4">Super Admin Dashboard</h4>
          <a href="{{ url_for('it.super_admin_dashboard') }}" class="sidebar-link {% if request.path == '/it/super-admin-dashboard' %}active{% endif %}"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
          <a href="{{ url_for('it.super_admin_pr_requests') }}" class="sidebar-link {% if request.path.startswith('/it/super-admin/pr') %}active{% endif %}"><i class="bi bi-file-text me-2"></i>PR</a>
          <a href="{{ url_for('it.create_pr') }}" class="sidebar-link {% if request.path == '/it/procurement/create-pr' %}active{% endif %}"><i class="bi bi-plus-circle me-2"></i>Create PR</a>
          <a href="{{ url_for('it.admin_approver_mappings_page') }}" class="sidebar-link {% if request.path == '/it/procurement/create-pr' %}active{% endif %}"><i class="bi bi-people-fill me-2"></i>Admin-Approver Mappings</a>
          <a href="{{ url_for('it.assets') }}" class="sidebar-link {% if request.path.startswith('/it/assets') %}active{% endif %}"><i class="bi bi-box-seam me-2"></i>Asset Master</a>
          <a href="{{ url_for('it.assign') }}" class="sidebar-link {% if request.path.startswith('/it/assign') %}active{% endif %}"><i class="bi bi-arrow-left-right me-2"></i>Assign Asset</a>
          <a href="{{ url_for('it.users') }}" class="sidebar-link {% if request.path.startswith('/it/users') %}active{% endif %}"><i class="bi bi-people me-2"></i>User Management</a>
          <a href="{{ url_for('it.bod_report') }}" class="sidebar-link {% if request.path == '/it/bod-report' %}active{% endif %}"><i class="bi bi-clipboard-check me-2"></i>BOD Report</a>
          <a href="{{ url_for('it.daily_infrastructure_status') }}" class="sidebar-link {% if request.path == '/it/daily-infrastructure-status' %}active{% endif %}"><i class="bi bi-calendar-check me-2"></i>Daily Infrastructure Status</a>
        <a href="{{ url_for('it.logout') }}" class="sidebar-link"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </nav>
      {% elif current_user.is_authenticated and current_user.role == 'user' %}
      <nav class="col-md-2 sidebar">
        <h4 class="text-center mb-4">Asset Management System</h4>
        <a href="{{ url_for('it.user_requests') }}" class="sidebar-link {% if request.path.startswith('/it/user-requests') %}active{% endif %}"><i class="bi bi-list-check me-2"></i>My Requests</a>
        <a href="{{ url_for('it.my_assets') }}" class="sidebar-link {% if request.path.startswith('/it/my-assets') %}active{% endif %}"><i class="bi bi-box-seam me-2"></i>My Asset Details</a>
        <a href="{{ url_for('it.logout') }}" class="sidebar-link"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </nav>
      {% endif %}
      <main class="{% if current_user.is_authenticated %}col-md-10 ms-sm-auto px-4{% else %}col-md-12{% endif %}">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} mt-3 alert-dismissible fade show" id="alert-{{ loop.index }}">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Auto-hide success messages after 2 seconds
    document.addEventListener('DOMContentLoaded', function() {
      const alerts = document.querySelectorAll('.alert-success');
      alerts.forEach(function(alert) {
        setTimeout(function() {
          const bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        }, 2000);
      });
      
      // Load dynamic admin menu if user is admin
      const userRole = document.body.getAttribute('data-user-role');
      const userId = document.body.getAttribute('data-user-id');
      
      if (userRole === 'admin' && userId) {
        loadAdminSidebarMenu(userId);
      }
    });
    
    // Function to load admin sidebar menu based on permissions
    function loadAdminSidebarMenu(userId) {
      // Use the new endpoint for admin users to get their own permissions
              fetch('/it/api/my-menu-permissions')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            const menuContainer = document.getElementById('adminSidebarMenu');
            if (menuContainer) {
              const menuItems = data.permissions;
              const currentPath = window.location.pathname;
              
              // Define menu structure - use correct URLs for admin users
              const menuStructure = [
                { key: 'dashboard', url: '/it/admin-dashboard', icon: 'bi bi-speedometer2', text: 'Dashboard' },
                { key: 'procurement', url: '/it/procurement/dashboard', icon: 'bi bi-shopping-cart', text: 'Procurement Dashboard' },
                { key: 'create_pr', url: '/it/procurement/create-pr', icon: 'bi bi-plus-circle', text: 'Create PR' },
                { key: 'approve_prs', url: '/it/procurement/approvals', icon: 'bi bi-check-circle', text: 'Approve PRs' },
                { key: 'upload_po', url: '/it/procurement/upload-po', icon: 'bi bi-upload', text: 'Upload PO' },
                { key: 'assign_asset', url: '/it/assign', icon: 'bi bi-arrow-left-right', text: 'Assign Asset' },
                { key: 'requests', url: '/it/requests', icon: 'bi bi-list-check', text: 'Requests' },
                { key: 'user_management', url: '/it/users', icon: 'bi bi-people', text: 'User Management' },
                { key: 'bod_report', url: '/it/bod-report', icon: 'bi bi-clipboard-check', text: 'BOD Report' },
                { key: 'daily_infrastructure', url: '/it/daily-infrastructure-status', icon: 'bi bi-calendar-check', text: 'Daily Infrastructure Status' }
              ];
              
              let menuHtml = '';
              menuStructure.forEach(menu => {
                if (menuItems[menu.key]) {
                  const isActive = currentPath === menu.url || currentPath.startsWith(menu.url);
                  menuHtml += `
                    <a href="${menu.url}" class="sidebar-link ${isActive ? 'active' : ''}">
                      <i class="${menu.icon} me-2"></i>${menu.text}
                    </a>
                  `;
                }
              });
              
              menuContainer.innerHTML = menuHtml;
            }
          } else {
            console.error('Failed to load menu permissions:', data.error);
          }
        })
        .catch(error => {
          console.error('Error loading admin menu:', error);
        });
    }
  </script>
</body>
</html> 